import buildHTML from "./buildHTML.js";
import buildMathML from "./buildMathML.js";
import { makeSpan } from "./buildCommon.js";
import Options from "./Options.js";
import Settings from "./Settings.js";
import Style from "./Style.js";

const buildTree = function (tree, expression, settings) {
  settings = settings || new Settings({});
  let startStyle = Style.TEXT;

  if (settings.displayMode) {
    startStyle = Style.DISPLAY;
  } // Setup the default options


  const options = new Options({
    style: startStyle
  }); // `buildHTML` sometimes messes with the parse tree (like turning bins ->
  // ords), so we build the MathML version first.

  const mathMLNode = buildMathML(tree, expression, options);
  const htmlNode = buildHTML(tree, options);
  const katexNode = makeSpan(["katex"], [mathMLNode, htmlNode]);

  if (settings.displayMode) {
    return makeSpan(["katex-display"], [katexNode]);
  } else {
    return katexNode;
  }
};

module.exports = buildTree;